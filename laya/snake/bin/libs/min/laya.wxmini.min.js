!function(e,i,n){n.un,n.uns;var t=n.static,o=n.class,a=n.getset,r=(n.__newvec,laya.utils.Browser),l=(laya.events.Event,laya.events.EventDispatcher),s=laya.resource.HTMLImage,u=laya.utils.Handler,c=laya.display.Input,f=laya.net.Loader,d=(laya.maths.Matrix,laya.renders.Render),h=laya.utils.RunDriver,p=laya.media.SoundChannel,v=laya.media.SoundManager,m=(laya.resource.Texture,laya.net.URL),_=laya.utils.Utils,y=function(){function i(){}return o(i,"laya.wx.mini.MiniAdpter"),i.getJson=function(e){return JSON.parse(e)},i.init=function(t,o){void 0===t&&(t=!1),void 0===o&&(o=!1),i._inited||(i._inited=!0,(i.window=e).navigator.userAgent.indexOf("MiniGame")<0||(i.isZiYu=o,i.isPosMsgYu=t,i.EnvConfig={},i.isZiYu||(I.setNativeFileDir("/layaairGame"),I.existDir(I.fileNativeDir,u.create(i,i.onMkdirCallBack))),i.systemInfo=wx.getSystemInfoSync(),i.window.focus=function(){},n.getUrlPath=function(){},i.window.logtime=function(e){},i.window.alertTimeLog=function(e){},i.window.resetShareInfo=function(){},i.window.CanvasRenderingContext2D=function(){},i.window.CanvasRenderingContext2D.prototype=i.window.wx.createCanvas().getContext("2d").__proto__,i.window.document.body.appendChild=function(){},i.EnvConfig.pixelRatioInt=0,h.getPixelRatio=i.pixelRatio,i._preCreateElement=r.createElement,r.createElement=i.createElement,h.createShaderCondition=i.createShaderCondition,_.parseXMLFromString=i.parseXMLFromString,c._createInputElement=w._createInputElement,i.EnvConfig.load=f.prototype.load,f.prototype.load=x.prototype.load,f.clearRes=i.clearRes,f.prototype._loadImage=g.prototype._loadImage,L.__init__(),C.__init__(),i.isZiYu&&t&&wx.onMessage(function(e){e.isLoad&&(I.ziyuFileData[e.url]=e.data)})))},i.clearRes=function(e,i){void 0===i&&(i=!1),e=m.formatURL(e);var n=f.getAtlas(e);if(n){for(var t=0,o=n.length;t<o;t++){var a=n[t],r=f.getRes(a);delete f.loadedMap[a],r&&r.destroy(i)}n.length=0,delete f.atlasMap[e],delete f.loadedMap[e],I.remove("",e)}else{var l=f.loadedMap[e];l&&(delete f.loadedMap[e],l instanceof laya.resource.Texture&&l.bitmap&&l.destroy(i))}},i.onMkdirCallBack=function(e,i){e||(I.filesListObj=JSON.parse(i.data))},i.pixelRatio=function(){if(!i.EnvConfig.pixelRatioInt)try{return console.log(i.systemInfo),i.EnvConfig.pixelRatioInt=i.systemInfo.pixelRatio,i.systemInfo.pixelRatio}catch(e){}return i.EnvConfig.pixelRatioInt},i.createElement=function(n){if("canvas"==n){var t;return 1==i.idx?i.isZiYu?(t=sharedCanvas).style={}:t=e.canvas:t=e.wx.createCanvas(),i.idx++,t}if("textarea"==n||"input"==n)return i.onCreateInput(n);if("div"==n){var o=i._preCreateElement(n);return o.contains=function(e){return null},o.removeChild=function(e){},o}return i._preCreateElement(n)},i.onCreateInput=function(e){var n=i._preCreateElement(e);return n.focus=w.wxinputFocus,n.blur=w.wxinputblur,n.style={},n.value=0,n.parentElement={},n.placeholder={},n.type={},n.setColor=function(e){},n.setType=function(e){},n.setFontFace=function(e){},n.addEventListener=function(e){},n.contains=function(e){return null},n.removeChild=function(e){},n},i.createShaderCondition=function(e){var i=this;return function(){return i[e.replace("this.","")]}},i.EnvConfig=null,i.window=null,i._preCreateElement=null,i._inited=!1,i.wxRequest=null,i.systemInfo=null,i.version="0.0.1",i.isZiYu=!1,i.isPosMsgYu=!1,i.parseXMLFromString=function(i){var n;i=i.replace(/>\s+</g,"><");try{n=(new e.Parser.DOMParser).parseFromString(i,"text/xml")}catch(e){throw"需要引入xml解析库文件"}return n},i.idx=1,i}(),g=function(){function e(){}return o(e,"laya.wx.mini.MiniImage"),e.prototype._loadImage=function(i){var n=this,t=!1;-1==i.indexOf("layaNativeDir/")&&(t=!0,i=m.formatURL(i)),I.getFileInfo(i)?e.onCreateImage(i,n,!t):-1!=i.indexOf("http://")||-1!=i.indexOf("https://")?I.downImg(i,new u(e,e.onDownImgCallBack,[i,n]),i):e.onCreateImage(i,n,!0)},e.onDownImgCallBack=function(i,n,t){t?n.onError(null):e.onCreateImage(i,n)},e.onCreateImage=function(e,i,n){function t(){l.onload=null,l.onerror=null,delete i.imgCache[e]}void 0===n&&(n=!1);var o;if(n)o=e;else{var a=I.getFileInfo(e).md5;o=I.getFileNativePath(a)}null==i.imgCache&&(i.imgCache={});var l,u=function(){t(),i.onLoaded(l)},c=function(){t(),i.event("error","Load image failed")};"nativeimage"==i._type?((l=new r.window.Image).crossOrigin="",l.onload=u,l.onerror=c,l.src=o,i.imgCache[e]=l):new s.create(o,{onload:u,onerror:c,onCreate:function(n){l=n,i.imgCache[e]=n}})},e}(),w=function(){function i(){}return o(i,"laya.wx.mini.MiniInput"),i._createInputElement=function(){c._initInput(c.area=r.createElement("textarea")),c._initInput(c.input=r.createElement("input")),c.inputContainer=r.createElement("div"),c.inputContainer.style.position="absolute",c.inputContainer.style.zIndex=1e5,r.container.appendChild(c.inputContainer),c.inputContainer.setPos=function(e,i){c.inputContainer.style.left=e+"px",c.inputContainer.style.top=i+"px"},n.stage.on("resize",null,i._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(i){e.dispatchEvent&&e.dispatchEvent("resize")}),v._soundClass=F,v._musicClass=F;var t=y.systemInfo.model,o=y.systemInfo.system;-1!=t.indexOf("iPhone")&&(r.onIPhone=!0),-1==o.indexOf("Android")&&-1==o.indexOf("Adr")||(r.onAndriod=!0)},i._onStageResize=function(){n.stage._canvasTransform.identity().scale(r.width/d.canvas.width/h.getPixelRatio(),r.height/d.canvas.height/h.getPixelRatio())},i.wxinputFocus=function(e){var i=c.inputElement.target;i&&!i.editable||(y.window.wx.offKeyboardConfirm(),y.window.wx.offKeyboardInput(),y.window.wx.showKeyboard({defaultValue:i.text,maxLength:i.maxChars,multiple:i.multiline,confirmHold:!0,confirmType:"done",success:function(e){},fail:function(e){}}),y.window.wx.onKeyboardConfirm(function(e){var n=e?e.value:"";i.text=n,i.event("input"),laya.wx.mini.MiniInput.inputEnter()}),y.window.wx.onKeyboardInput(function(e){var n=e?e.value:"";i.multiline||-1==n.indexOf("\n")?(i.text=n,i.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},i.inputEnter=function(){c.inputElement.target.focus=!1},i.wxinputblur=function(){i.hideKeyboard()},i.hideKeyboard=function(){y.window.wx.offKeyboardConfirm(),y.window.wx.offKeyboardInput(),y.window.wx.hideKeyboard({success:function(e){console.log("隐藏键盘")},fail:function(e){console.log("隐藏键盘出错:"+(e?e.errMsg:""))}})},i}(),x=function(){function e(){}return o(e,"laya.wx.mini.MiniLoader"),e.prototype.load=function(i,n,t,o,a){void 0===t&&(t=!0),void 0===a&&(a=!1);var r=this;r._url=i,0===i.indexOf("data:image")?r._type=n="image":r._type=n||(n=r.getTypeFromUrl(i)),r._cache=t,r._data=null;var l="ascii";-1!=i.indexOf(".fnt")?l="utf8":"arraybuffer"==n&&(l="");var s=_.getFileExtension(i);if(-1!=e._fileTypeArr.indexOf(s))y.EnvConfig.load.call(this,i,n,t,o,a);else if(I.getFileInfo(i))y.EnvConfig.load.call(this,i,n,t,o,a);else{if(-1!=i.indexOf("layaNativeDir/")){if(y.isZiYu){var c=I.ziyuFileData[i];return void r.onLoaded(c)}return void I.read(i,l,new u(e,e.onReadNativeCallBack,[l,i,n,t,o,a,r]))}-1!=(i=m.formatURL(i)).indexOf("http://")||-1!=i.indexOf("https://")?y.EnvConfig.load.call(r,i,n,t,o,a):I.readFile(i,l,new u(e,e.onReadNativeCallBack,[l,i,n,t,o,a,r]),i)}},e.onReadNativeCallBack=function(e,i,n,t,o,a,r,l,s){if(void 0===t&&(t=!0),void 0===a&&(a=!1),void 0===l&&(l=0),l)1==l&&y.EnvConfig.load.call(r,i,n,t,o,a);else{var u;u="json"==n||"atlas"==n?y.getJson(s.data):"xml"==n?_.parseXMLFromString(s.data):s.data,r.onLoaded(u),!y.isZiYu&&y.isPosMsgYu&&"arraybuffer"!=n&&wx.postMessage({url:i,data:u,isLoad:!0})}},t(e,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),e}(),C=function(){function e(){}return o(e,"laya.wx.mini.MiniLocation"),e.__init__=function(){y.window.navigator.geolocation.getCurrentPosition=e.getCurrentPosition,y.window.navigator.geolocation.watchPosition=e.watchPosition,y.window.navigator.geolocation.clearWatch=e.clearWatch},e.getCurrentPosition=function(e,i,n){var t;(t={}).success=function(i){null!=e&&e(i)},t.fail=i,y.window.wx.getLocation(t)},e.watchPosition=function(i,t,o){e._curID++;var a;return a={},a.success=i,a.error=t,e._watchDic[e._curID]=a,n.timer.loop(1e3,null,e._myLoop),e._curID},e.clearWatch=function(i){delete e._watchDic[i],e._hasWatch()||n.timer.clear(null,e._myLoop)},e._hasWatch=function(){var i;for(i in e._watchDic)if(e._watchDic[i])return!0;return!1},e._myLoop=function(){e.getCurrentPosition(e._mySuccess,e._myError)},e._mySuccess=function(i){var n={};n.coords=i,n.timestamp=r.now();var t;for(t in e._watchDic)e._watchDic[t].success&&e._watchDic[t].success(n)},e._myError=function(i){var n;for(n in e._watchDic)e._watchDic[n].error&&e._watchDic[n].error(i)},e._watchDic={},e._curID=0,e}(),L=function(e){function i(){i.__super.call(this)}o(i,"laya.wx.mini.MiniAccelerator",e);var n=i.prototype;return n.on=function(n,t,o,a){return e.prototype.on.call(this,n,t,o,a),i.startListen(this.onDeviceOrientationChange),this},n.off=function(n,t,o,a){return void 0===a&&(a=!1),this.hasListener(n)||i.stopListen(),e.prototype.off.call(this,n,t,o,a)},i.__init__=function(){try{var e;if(!(e=laya.device.motion.Accelerator))return;e.prototype.on=i.prototype.on,e.prototype.off=i.prototype.off}catch(e){}},i.startListen=function(e){if(i._callBack=e,!i._isListening){i._isListening=!0;try{wx.onAccelerometerChange(i.onAccelerometerChange)}catch(e){}}},i.stopListen=function(){i._isListening=!1;try{wx.stopAccelerometer({})}catch(e){}},i.onAccelerometerChange=function(e){var n;(n={}).acceleration=e,n.accelerationIncludingGravity=e,n.rotationRate={},null!=i._callBack&&i._callBack(n)},i._isListening=!1,i._callBack=null,i}(l),I=function(e){function i(){i.__super.call(this)}return o(i,"laya.wx.mini.MiniFileMgr",l),i.isLoadFile=function(e){return-1!=i._fileTypeArr.indexOf(e)},i.getFileInfo=function(e){var n=e.split("?")[0],t=i.filesListObj[n];return null==t?null:t},i.onFileUpdate=function(e,n){var t=e.split("/"),o=t[t.length-1],a=i.getFileInfo(n);null==a?i.onSaveFile(n,o):a.readyUrl!=n&&i.remove(o,n)},i.exits=function(e,n){var t=i.getFileNativePath(e);i.fs.getFileInfo({filePath:t,success:function(e){null!=n&&n.runWith([0,e])},fail:function(e){null!=n&&n.runWith([1,e])}})},i.read=function(e,n,t,o){void 0===n&&(n="ascill"),void 0===o&&(o="");var a;a=""!=o?i.getFileNativePath(e):e,i.fs.readFile({filePath:a,encoding:n,success:function(e){null!=t&&t.runWith([0,e])},fail:function(e){e&&""!=o?i.down(o,n,t,o):null!=t&&t.runWith([1])}})},i.readNativeFile=function(e,n){i.fs.readFile({filePath:e,encoding:"",success:function(e){null!=n&&n.runWith([0])},fail:function(e){null!=n&&n.runWith([1])}})},i.down=function(e,n,t,o){void 0===n&&(n="ascill"),void 0===o&&(o="");var a=i.getFileNativePath(o);i.wxdown({url:e,filePath:a,success:function(e){200===e.statusCode&&i.readFile(e.filePath,n,t,o)},fail:function(e){null!=t&&t.runWith([1,e])}}).onProgressUpdate(function(e){null!=t&&t.runWith([2,e.progress])})},i.readFile=function(e,n,t,o){void 0===n&&(n="ascill"),void 0===o&&(o=""),i.fs.readFile({filePath:e,encoding:n,success:function(n){-1==e.indexOf("http://")&&-1==e.indexOf("https://")||i.onFileUpdate(e,o),null!=t&&t.runWith([0,n])},fail:function(e){e&&null!=t&&t.runWith([1,e])}})},i.downImg=function(e,n,t){void 0===t&&(t="");i.wxdown({url:e,success:function(e){200===e.statusCode&&i.copyFile(e.tempFilePath,t,n)},fail:function(e){null!=n&&n.runWith([1,e])}})},i.copyFile=function(e,n,t){var o=e.split("/"),a=o[o.length-1],r=(n.split("?")[0],i.getFileInfo(n)),l=i.getFileNativePath(a);i.getCacheUseSize()+5242880>=52428800&&i.onClearCacheRes(5242880),i.fs.copyFile({srcPath:e,destPath:l,success:function(e){r?r.readyUrl!=n?i.remove(a,n,t):null!=t&&t.runWith([0]):(i.onSaveFile(n,a),null!=t&&t.runWith([0]))},fail:function(e){null!=t&&t.runWith([1,e])}})},i.onClearCacheRes=function(e){var n=0;for(var t in i.filesListObj){var o=i.filesListObj[t];if("fileUsedSize"!=t){if(n>=e)break;var a=f.getRes(o.readyUrl);a&&0==a.bitmap.useNum?(n+=o.size,i.remove("",o.readyUrl)):null==a&&(n+=o.size,i.remove("",o.readyUrl))}}},i.getFileNativePath=function(e){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+e},i.remove=function(e,n,t){void 0===n&&(n="");var o=i.getFileInfo(n),a=i.getFileNativePath(o.md5);i.fs.unlink({filePath:a,success:function(o){var a=""!=e;i.onSaveFile(n,e,a),null!=t&&t.runWith([0])},fail:function(e){}})},i.onSaveFile=function(e,n,t){void 0===t&&(t=!0);var o=e.split("?")[0];if(null==i.filesListObj.fileUsedSize&&(i.filesListObj.fileUsedSize=0),t){i.filesListObj[o]={md5:n,readyUrl:e};var a=i.getFileNativePath(n);i.fs.getFileInfo({filePath:a,success:function(t){i.filesListObj[o]={md5:n,readyUrl:e,size:t.size},i.filesListObj.fileUsedSize=parseInt(i.filesListObj.fileUsedSize)+t.size,i.fs.writeFile({filePath:i.fileNativeDir+"/"+i.fileListName,encoding:"utf8",data:JSON.stringify(i.filesListObj),success:function(e){},fail:function(e){}})},fail:function(e){console.log("fail"),console.log(e)},complete:function(e){}})}else{var r=parseInt(i.filesListObj[o].size);i.filesListObj.fileUsedSize=parseInt(i.filesListObj.fileUsedSize)-r,delete i.filesListObj[o],i.fs.writeFile({filePath:i.fileNativeDir+"/"+i.fileListName,encoding:"utf8",data:JSON.stringify(i.filesListObj),success:function(e){},fail:function(e){}})}},i.getCacheUseSize=function(){return i.filesListObj&&i.filesListObj.fileUsedSize?i.filesListObj.fileUsedSize:0},i.existDir=function(e,n){i.fs.mkdir({dirPath:e,success:function(e){null!=n&&n.runWith([0,{data:JSON.stringify({})}])},fail:function(e){-1!=e.errMsg.indexOf("file already exists")?i.readSync(i.fileListName,"utf8",n):null!=n&&n.runWith([1,e])}})},i.readSync=function(e,n,t,o){void 0===n&&(n="ascill"),void 0===o&&(o="");var a,r=i.getFileNativePath(e);try{a=i.fs.readFileSync(r,n),null!=t&&t.runWith([0,{data:a}])}catch(e){null!=t&&t.runWith([1])}},i.setNativeFileDir=function(e){i.fileNativeDir=wx.env.USER_DATA_PATH+e},i.filesListObj={},i.fileNativeDir=null,i.fileListName="layaairfiles.txt",i.ziyuFileData={},t(i,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),i}(),F=function(e){function i(){this._sound=null,this.url=null,this.loaded=!1,i.__super.call(this),this._sound=i._createSound()}o(i,"laya.wx.mini.MiniSound",l);var n=i.prototype;return n.load=function(e){function n(){t._sound.onCanplay(i.bindToThis(t.onCanPlayCallBack,t)),t._sound.onError(i.bindToThis(t.onCanPlayCallBack,t))}var t=this;if(e=m.formatURL(e),this.url=e,i._audioCache[e])this.event("complete");else{this._sound.src=e,this._sound.onCanplay(function(){n(),o.loaded=!0,o.event("complete"),i._audioCache[o.url]=o});var o=this;this._sound.onError(function(){n(),o.event("error")})}},n.onCanPlayCallBack=function(){},n.play=function(e,n){void 0===e&&(e=0),void 0===n&&(n=0);var t;this.url==v._tMusic?(i._musicAudio||(i._musicAudio=i._createSound()),t=i._musicAudio):t=i._createSound(),t.src=this.url;var o=new E(t);return o.url=this.url,o.loops=n,o.startTime=e,o.play(),v.addChannel(o),o},n.dispose=function(){var e=i._audioCache[this.url];e&&(e.src="",delete i._audioCache[this.url])},a(0,n,"duration",function(){return this._sound.duration}),i._createSound=function(){return i._id++,y.window.wx.createInnerAudioContext()},i.bindToThis=function(e,i){return e.bind(i)},i._musicAudio=null,i._id=0,i._audioCache={},i}(),E=function(e){function i(e){this._audio=null,this._onEnd=null,i.__super.call(this),this._audio=e,this._onEnd=i.bindToThis(this.__onEnd,this),e.onEnded(this._onEnd)}o(i,"laya.wx.mini.MiniSoundChannel",p);var t=i.prototype;return t.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(n.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");this.loops>0&&this.loops--,this.startTime=0,this.play()},t.play=function(){this.isStopped=!1,v.addChannel(this),this._audio.play()},t.stop=function(){this.isStopped=!0,v.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.pause(),this._audio.onStop(i.bindToThis(this.onStopEndEd,this)),this._audio.onEnded(i.bindToThis(this.onStopEndEd,this)),this._audio=null)},t.onStopEndEd=function(){},t.pause=function(){this.isStopped=!0,this._audio.pause()},t.resume=function(){this._audio&&(this.isStopped=!1,v.addChannel(this),this._audio.play())},a(0,t,"position",function(){return this._audio?this._audio.currentTime:0}),a(0,t,"duration",function(){return this._audio?this._audio.duration:0}),a(0,t,"volume",function(){return 1},function(e){}),i.bindToThis=function(e,i){return e.bind(i)},i}()}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});for(var n in Laya){var t=Laya[n];t&&t.__isclass&&(i[n]=t)}});